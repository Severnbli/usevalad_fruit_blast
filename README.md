# Usevalad Fruit Blast

A small but polished 2D arcade made with Unity where fruits explode, bounce, and shower XP. The project demonstrates a modular feature-based architecture, custom lightweight physics, a lifecycle state machine, difficulty systems, and a clean UI experience. It is intended as a readable reference and a fun prototype you can extend.

https://github.com/user-attachments/assets/2e938b24-c962-4b4d-a646-1c7392ddf132


_THIS FILE GENERATED BY AI_


## Highlights
- **Core loop**: spawn falling fruits, tap/click to destroy, collect XP, survive until health runs out.
- **Lifecycle state machine**: bootstrap → start → core gameplay → end/defeat → reset.
- **Feature container (IOC-lite)**: systems are registered/configured centrally and composed at runtime.
- **Custom physics engine**: bespoke loop, forces, colliders, collision resolver, camera bounds.
- **Gyroscope support**: optional gravity tilt using the device gyro.
- **Input abstraction**: mouse, touch pointers, and enable/disable user input per state.
- **UI system**: health/XP/level bars, popups, perk selection, pause and defeat screens.
- **Experience/Leveling**: gain XP, visual effects, progression feedback.
- **Difficulty scaling**: runtime adjustments to keep sessions engaging.
- **Effects**: split-sprite and explosion visuals, DOTween animations.


## Tech Stack
- **Unity**: 2022.3.45f1
- **Packages/Libraries**:
  - Cysharp **UniTask** for async game flow
  - **DOTween** for tweened UI/FX
  - **TextMeshPro** for crisp UI text
  - **Odin Inspector** (editor-time tooling)


## Selected Components (what they do)
- `SystemCoordinator`: bootstraps and registers features, wires configs, runs update loops.
- `SystemConfig`: ScriptableObject containing all feature configs.
- `LifecycleStateMachine`: controls game flow across `Bootstrap`, `StartGame`, `CoreGame`, `EndGame`, `DefeatDialog`, `ResetGame` states.
- `FieldCatcherSpawner`: continuously spawns gameplay objects within the camera field.
- `PhysicsEngine`: fixed-step engine; moves bodies, resolves collisions, then applies forces each tick.
- `PhysicsEngineConfig`: tuning for min sleep speed and max cull speed.
- `DynamicBody`: per-object physics state (velocity, mass, gravity/bounce factors, flags) and `ApplyForce`.
- `BaseCollider` (+ `CircleCollider`, `RectangleCollider`): attach to bodies, provide area/bounds, optional triggers.
- `CollisionResolver`: iterative collision resolution for registered colliders.
- `GravityForceProvider` / `ExplosionForceProvider`: compute forces per body; engine accumulates them.
- `CameraFieldProvider`: calculates world bounds from the active camera.
- `ColliderFieldCatcher`: detects and handles objects leaving the play field.
- `GameTimeProvider`: central access to scaled/unscaled time.
- `UIProvider`: root for UI widgets and popups.
- Bars: `HealthBar`, `ProgressBar`, `LevelBar` for live stats display.
- Popups: `TextPopup`, `ScreenPopupSwitcher`, `PerkSelectionPopup`.
- `ExperienceProvider` / `HealthProvider`: manage XP/level and health.
- `DifficultyScaler`: adjusts difficulty over time/session.
- `GyroscopeProvider` and `GyroscopeGravityChanger`: reads device tilt and rotates global gravity vector.
- Effects: `ExplosionProvider`, `SplitSpriteEffectProvider`, `ExperienceEffectProvider`, `EffectObjectsContainer`.
- Input: `TouchProvider`, `MouseProvider` with centralized enable/disable.


## Gameplay Overview
- **Goal**: score XP by destroying fruits; avoid losing all health.
- **Loop**:
  1) Fruits spawn within the camera field and fall under gravity.
  2) Tap/click fruits to destroy them; explosions and split effects play.
  3) Pickup XP and level up; occasionally select perks.
  4) Difficulty ramps over matches; session ends when health reaches minimum.


## Controls
- **Desktop**: left-click to destroy fruits.
- **Mobile**: tap to destroy fruits.
- **Gyroscope (mobile)**: tilt to change gravity direction if enabled.


## Setup
1. Install Unity Editor **2022.3.45f1**.
2. Clone or download this repository.
3. Open the project in Unity via the root folder `Usevalad Fruit Blast`.
4. Open the main scene in `Assets/_Project/Scenes`.
5. Press Play.


## Configuration
Most systems expose ScriptableObject configs under `Assets/_Project/Configs`. Typical adjustments:
- **Spawning**: spawn rates, bounds, object pools
- **Physics**: gravity strength, explosion forces, colliders
- **Difficulty**: scaling curves/thresholds
- **UI**: bar thresholds, colors, FX timings

To tweak, select the relevant asset and edit values in the Inspector. Runtime wiring is performed by `SystemCoordinator` using `SystemConfig`.


## Architecture Notes
- **Feature pattern**: each subsystem inherits from a base feature class and can implement interfaces such as configurable and updatable. Features are added to a central `Context` and can be retrieved by type.
- **State machine**: `LifecycleStateMachine` drives app flow; states enable/disable input, manage spawners, and switch on conditions (e.g., health threshold).
- **Async flow**: long-running loops (spawning, state guards) use UniTask with cancellation tokens linked to lifecycle and context lifetimes.
- **Input gating**: user input can be toggled per state to avoid race conditions.
- **Effects**: FX providers centralize spawning of visuals (explosions, split sprites) and coordinate with DOTween for timings.


### Custom Physics Engine
- **Core**: `PhysicsEngine` runs on fixed steps via the feature loop. It orchestrates three phases per tick:
  1) Move dynamic bodies by current velocity and `Time.fixedDeltaTime`
  2) Resolve collisions using `CollisionResolver` across registered `BaseCollider` instances
  3) Apply forces from all `ForceProvider`s to each `DynamicBody`
- **Bodies**: `DynamicBody` holds physical state: `Velocity`, `Mass`, `GravityFactor`, `BouncinessFactor`, `UseGravity`, `IsStatic`, `IsSleep`.
- **Forces**: Extend `ForceProvider` and implement `GetForceByDynamicBody(DynamicBody)` to produce per-body forces. Built-ins: gravity and explosion.
- **Colliders**: Implementations of `BaseCollider` (e.g., `CircleCollider`, `RectangleCollider`) expose area, bounding shapes, and are linked to their owning `DynamicBody`.
- **Collision math**: shape figures in `Physics/Figures` and services in `Physics/Services/Collisions` provide detection and resolution utilities.
- **Sleep/limits**: Bodies below `MinBodySpeed` fall asleep; above `MaxBodySpeed` can be culled for stability. Both are configured in `PhysicsEngineConfig`.
- **Registration**: Bodies, colliders, and force providers self-register with the engine during `Start/Init` and deregister on destroy.


## How to Build
- **Android**:
  - Open `File → Build Settings…`, switch to Android
  - Ensure scenes are added in order (from `EditorBuildSettings` if needed)
  - Press Build; an example APK exists in `Builds/FruitBlast.apk`
- **Desktop**:
  - Switch target to your platform (Windows/macOS/Linux) and Build


### Extending Physics
- Add a new force: subclass `ForceProvider` and register automatically via `Init()`.
- Add a new collider: subclass `BaseCollider` and provide area, bounding shapes, and trigger behavior.
- Customize motion: update `DynamicBody.ApplyForce` and the integration step if you prefer a different integrator.
- Tweak stability: adjust `MinBodySpeed` and `MaxBodySpeed` in `PhysicsEngineConfig`.


## Extending the Game
- Add a new perk: create a class extending `BasePerk`, register it in the `PerksProvider`, and add UI/icon assets.
- Create a new effect: implement a provider under `Features/Effects` and reference it from `SystemCoordinator` configs.
- Tune difficulty: adjust curves in `DifficultyScaler` config to change pacing.
- Add content: new fruit prefabs, sprites, and associated spawn rules.


## Known Demonstrated Systems
- Lifecycle state orchestration with safe cancellation
- Perk discovery/selection and conditional triggering
- Difficulty ramping by configuration
- XP/Level flow with UI bars and popups
- Abstracted mouse/touch/gyro input and input gating
- Lightweight physics helpers (gravity/explosion/colliders)
- Camera-bounded spawning and field catching


## Dependencies and Credits
- Cysharp `UniTask`
- Demigiant `DOTween`
- TextMesh Pro
- Sirenix `Odin Inspector`


## License
See `LICENSE`. 
